@page "/guidhelpers"
@inject IJSRuntime JSRuntime

<div class="max-w-screen-xl mx-auto">
    <h1 class="text-2xl font-bold text-gray-800 mb-6">GUID Generator</h1>

    <!-- Generate GUID Card -->
    <div class="bg-white rounded-lg shadow-md mb-8">
        <div class="border-b border-gray-200 px-6 py-4">
            <h2 class="text-lg font-semibold text-gray-800">Generate GUID</h2>
        </div>
        <div class="p-6">
            <div class="flex flex-col md:flex-row gap-4">
                <div class="flex-grow">
                    <textarea @bind="NewGuid" class="w-full p-2 border border-gray-300 rounded-md bg-gray-50" disabled rows="1"></textarea>
                </div>
                <div>
                    <button @onclick="GenerateGuid" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
                        Generate
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- GUID from long and int Card -->
    <div class="bg-white rounded-lg shadow-md mb-8">
        <div class="border-b border-gray-200 px-6 py-4">
            <h2 class="text-lg font-semibold text-gray-800">GUID from long and int</h2>
        </div>
        <div class="p-6">
            <div class="flex flex-col md:flex-row gap-6 mb-4">
                <div class="flex-1">
                    <label for="longInput" class="block text-sm font-medium text-gray-700 mb-1">Long Input</label>
                    <input type="text" @bind="LongInput" class="w-full p-2 border border-gray-300 rounded-md" name="longInput" id="longInput" />
                </div>
                <div class="flex-1">
                    <label for="intInput" class="block text-sm font-medium text-gray-700 mb-1">Int Input</label>
                    <input type="text" @bind="IntInput" class="w-full p-2 border border-gray-300 rounded-md" name="intInput" id="intInput" />
                </div>
                <div class="flex items-end">
                    <button @onclick="GuidFromLongAndInt" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
                        Generate
                    </button>
                </div>
            </div>
            <div class="mt-4">
                <label class="block text-sm font-medium text-gray-700 mb-1">Result:</label>
                <textarea @bind="LongIntToGuidResult" disabled class="w-full p-2 border border-gray-300 rounded-md bg-gray-50" rows="1"></textarea>
            </div>
        </div>
    </div>

    <!-- Split GUID to long and int Card -->
    <div class="bg-white rounded-lg shadow-md">
        <div class="border-b border-gray-200 px-6 py-4">
            <h2 class="text-lg font-semibold text-gray-800">Split GUID to long and int</h2>
        </div>
        <div class="p-6">
            <div class="flex flex-col md:flex-row gap-4 mb-6">
                <div class="flex-grow">
                    <input type="text" @bind="Section3GuidInput" class="w-full p-2 border border-gray-300 rounded-md" name="sec3LongInput" id="sec3LongInput" placeholder="Enter GUID" />
                </div>
                <div>
                    <button @onclick="SplitGuidToLongAndInt" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
                        Generate
                    </button>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Long Result:</label>
                    <textarea @bind="Section3LongResult" disabled class="w-full p-2 border border-gray-300 rounded-md bg-gray-50" rows="1"></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Int Result:</label>
                    <textarea @bind="Section3IntResult" disabled class="w-full p-2 border border-gray-300 rounded-md bg-gray-50" rows="1"></textarea>
                </div>
            </div>
        </div>
    </div>
</div>

@code {
    public string NewGuid { get; set; } = Guid.NewGuid().ToString();

    public string? LongInput { get; set; }
    public string? IntInput { get; set; }
    public string? LongIntToGuidResult { get; set; }

    public string? Section3GuidInput { get; set; }
    public string? Section3LongResult { get; set; }
    public string? Section3IntResult { get; set; }

    private void GenerateGuid()
    {
        NewGuid = Guid.NewGuid().ToString();
    }

    private void GuidFromLongAndInt()
    {
        long.TryParse(LongInput, out long parsedLong);
        int.TryParse(IntInput, out int parsedInt);

        if (parsedInt > 0 && parsedLong > 0)
        {
            var bytes = new byte[16];
            BitConverter.GetBytes(parsedLong).CopyTo(bytes, 0);
            BitConverter.GetBytes(parsedInt).CopyTo(bytes, 12);

            LongIntToGuidResult = new Guid(bytes).ToString();
        }
    }

    private void SplitGuidToLongAndInt()
    {
        var isParseSuccess = Guid.TryParse(Section3GuidInput, out Guid parsedGuid);

        if (isParseSuccess)
        {
            var gb = parsedGuid.ToByteArray();

            Section3LongResult = BitConverter.ToInt64(gb, 0).ToString();
            Section3IntResult = BitConverter.ToInt32(gb, 12).ToString();
        }
    }
}